{% extends 'inventory/base.html' %}

{% block content %}
		
		
		
	  <div class="row">
		<div class="col">

	
		
		<div id="map" style="height:800px; width:100%"></div>

	  </div>
	  <div class="mb-3"></div>
	  <div class="row">
		  <div class="col-12 col-md-6">
			  <h5>Legend</h5>
			  <div class="card">
				<ul class="list-group list-group-flush">
				  <li class="list-group-item">
					  <svg xmlns="http://www.w3.org/2000/svg"  width="40" height="40">
						  <path stroke="black"
							stroke-width="1" fill="#0F0"  d="M 11 36 C 10 18 2 23 2 12 A 10 10 90 1 1 22 12 C 22 23 14 18 13 36 A 1 1 90 0 1 11 36 z" />
						 </svg> 
						 Existing Tree</li>
				  <li class="list-group-item">
						 <svg xmlns="http://www.w3.org/2000/svg"  width="40" height="40">
							 <path stroke="black"
							   stroke-width="1" fill="#FD0"  d="M 11 36 C 10 18 2 23 2 12 A 10 10 90 1 1 22 12 C 22 23 14 18 13 36 A 1 1 90 0 1 11 36 z" />
							</svg> 
							Existing Tree - DED supected or confirmed</li>
							<li class="list-group-item">
							<svg xmlns="http://www.w3.org/2000/svg"  width="40" height="40">
								<path stroke="black"
								  stroke-width="1" fill="#F00"  d="M 11 36 C 10 18 2 23 2 12 A 10 10 90 1 1 22 12 C 22 23 14 18 13 36 A 1 1 90 0 1 11 36 z" />
							   </svg> 
							   Removed Tree</li>
							   <li class="list-group-item">
							   <svg xmlns="http://www.w3.org/2000/svg"  width="40" height="40">
								   <path stroke="black"
									 stroke-width="1" fill="#AAA"  d="M 11 36 C 10 18 2 23 2 12 A 10 10 90 1 1 22 12 C 22 23 14 18 13 36 A 1 1 90 0 1 11 36 z" />
								  </svg> 
								  Unverified (not yet confirmed in 2022)</li>
							   
								 <li class="list-group-item">
									 Click on a tag to go to tree detail page
								 </li>
				</ul>

			  </div>
		  </div>
	  </div>

{% endblock %}
	  
	  
	  {% block script %}
<script
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyABHi5hOb62Ku_9JUf-_wJyvO4bpGCV6iU&callback=initMap&v=weekly"
		defer
	  ></script>
	  <script>
	  
	  // Initialize and add the map
	  function initMap() {
	  
		const castine = { lat: 44.390492, lng: -68.804612 };
		
		function pinSymbol(color) {
			return {
				//path: 'M -1 0 C -2 -10 -10 -5 -10 -16 A 10 10 0 1 1 10 -16 C 10 -5 2 -10 1 0 A 1 1 0 0 1 -1 0 z', // pin shape
				// path: 'M -15, 0 a 15,15 0 1,1 30,0 a 15,15 0 1,1 -30,0', // largish circle, good for including text
				path: 'M -10, 0 a 10,10 0 1,1 20,0 a 10,10 0 1,1 -20,0', // smaller circle (no text)
				
				//https://yqnn.github.io/svg-path-editor/
				fillColor: color,
				fillOpacity: 1,
				strokeColor: '#555',
				strokeWeight: 1,
				//scale: 1.5,
				//labelOrigin: new google.maps.Point(0, -15)
		   };
		}

		const map = new google.maps.Map(document.getElementById("map"), {
		  zoom: 15,
		  center: castine,
		});
		
		function createTreePin(tag, latitude, longitude, color) {
			 var marker = new google.maps.Marker({
			   position: { lat: latitude, lng: longitude },
			   //label: tag,
			   title: tag,
			   url: '/inventory/tree/' + tag,
			   map: map,
			   icon: pinSymbol(color)	
			   
			 });
			

			
			
			google.maps.event.addListener(marker, 'click', function() {
				window.location.href = this.url;
			});
		}
		
		function markMissingTree(latitude, longitude, tag) {
			createTreePin(tag, latitude, longitude, "#AAA");
		}
		
		{% for tree in tree_list %}
		{% if tree.latitude > 0 %}
		
		
		{% if tree.is_removed %}
			createTreePin("{{ tree.tag }}", {{ tree.latitude}}, {{ tree.longitude}}, "#F00");
		{% elif tree.has_ded %}
			createTreePin("{{ tree.tag }}", {{ tree.latitude}}, {{ tree.longitude}}, "#FD0");
		{% elif tree.gps_error_ft == -1 %}
			createTreePin("{{ tree.tag }}", {{ tree.latitude}}, {{ tree.longitude}}, "#AAA");
		{% else %}
			createTreePin("{{ tree.tag }}", {{ tree.latitude}}, {{ tree.longitude}}, "#0F0");
		{% endif %}	
		
		{% endif %}	
		{% endfor %}
		
		
		
		// function myLocationSymbol() {
		// 	return {
		// 		path: 'M 2 0 A 1 1 0 0 0 -2 0 A 1 1 0 0 0 2 0',
		// 		//https://yqnn.github.io/svg-path-editor/
		// 		fillColor: '#00F',
		// 		fillOpacity: 1,
		// 		strokeColor: '#000',
		// 		strokeWeight: 1,
		// 		scale: 1.5,
		//    };
		// }
		// 
		// 
		// var my_position = new google.maps.Marker({
		// 
		// 	map: map,
		// 	icon: pinSymbol("#00F")	
		//   });
		// 
		//   function locationSuccess(position) {
		// var newLatLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
		// my_position.setPosition(newLatLng);
		//   }
		//   
		//   function locationError(error) {
		// 	  if (error.code == 1) {
		// 		  alert("Access to location denied. You may have to enable location sharing in your phone's settings.");
		// 	  }
		// 	  else {
		// 		  alert("Unable to get location data:\r\n" + "Error code: " + error.code + "\r\nMessage: " + error.message);
		// 	  }
		//   }
		//   const options = {
		// 	  enableHighAccuracy: true,
		// 	  timeout: Infinity,
		// 	  maximumAge: 0
		// 	};
		//   navigator.geolocation.watchPosition(locationSuccess, locationError, options);
	  }
	  
	  

	  

	  
	  
	  window.initMap = initMap;
	  </script>
	  {% endblock %}

	
</body>